---
# Machine-ID Generation (replaces broken machineid module)
# Uses dbus-uuidgen which works in chroot without systemd

dontChroot: false
timeout: 30
script:
  - command: /bin/bash
    args:
      - -c
      - |
        set -e
        echo "Generating machine-id..."
        
        # Create machine-id using dbus-uuidgen (works in chroot)
        dbus-uuidgen --ensure=/etc/machine-id
        
        # Create systemd machine-id link if needed
        if [ ! -f /var/lib/dbus/machine-id ]; then
          mkdir -p /var/lib/dbus
          ln -sf /etc/machine-id /var/lib/dbus/machine-id
        fi
        
        # Verify
        if [ -s /etc/machine-id ]; then
          echo "âœ“ Machine-ID created: $(cat /etc/machine-id)"
        else
          echo "ERROR: Failed to create machine-id"
          exit 1
        fi
