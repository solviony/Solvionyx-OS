name: Build & Release Solvionyx OS Editions

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  build-gnome:
    name: Aurora (GNOME Edition)
    runs-on: ubuntu-latest
    permissions:
      contents: write
    outputs:
      gnome_iso: ${{ steps.upload.outputs.artifact-url }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y qemu-utils xorriso squashfs-tools genisoimage debootstrap wget curl unzip zip

      - name: Build GNOME Edition
        run: |
          chmod +x build_iso_debian.sh
          sudo DESKTOP=gnome ./build_iso_debian.sh
          mv iso_output/*.iso Solvionyx-OS-v4.3.4-gnome.iso

      - name: Upload GNOME ISO
        id: upload
        uses: actions/upload-artifact@v4
        with:
          name: Solvionyx-OS-v4.3.4-GNOME
          path: Solvionyx-OS-v4.3.4-gnome.iso

  build-xfce:
    name: Aurora Lite (XFCE Edition)
    runs-on: ubuntu-latest
    permissions:
      contents: write
    outputs:
      xfce_iso: ${{ steps.upload.outputs.artifact-url }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y qemu-utils xorriso squashfs-tools genisoimage debootstrap wget curl unzip zip

      - name: Build XFCE Edition
        run: |
          chmod +x build_iso_debian.sh
          sudo DESKTOP=xfce ./build_iso_debian.sh
          mv iso_output/*.iso Solvionyx-OS-v4.3.4-xfce.iso

      - name: Upload XFCE ISO
        id: upload
        uses: actions/upload-artifact@v4
        with:
          name: Solvionyx-OS-v4.3.4-XFCE
          path: Solvionyx-OS-v4.3.4-xfce.iso

  build-kde:
    name: Aurora Studio (KDE Edition)
    runs-on: ubuntu-latest
    permissions:
      contents: write
    outputs:
      kde_iso: ${{ steps.upload.outputs.artifact-url }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y qemu-utils xorriso squashfs-tools genisoimage debootstrap wget curl unzip zip

      - name: Build KDE Edition
        run: |
          chmod +x build_iso_debian.sh
          sudo DESKTOP=kde ./build_iso_debian.sh
          mv iso_output/*.iso Solvionyx-OS-v4.3.4-kde.iso

      - name: Upload KDE ISO
        id: upload
        uses: actions/upload-artifact@v4
        with:
          name: Solvionyx-OS-v4.3.4-KDE
          path: Solvionyx-OS-v4.3.4-kde.iso

  release:
    name: Publish Release
    runs-on: ubuntu-latest
    needs: [build-gnome, build-xfce, build-kde]
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: release/
          pattern: Solvionyx-OS-v4.3.4-*

      - name: Create checksums
        run: |
          cd release
          sha256sum * > SHA256SUMS.txt
          ls -lh

      - name: Publish GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: Aurora-v4.3.4
          name: "Solvionyx OS Aurora v4.3.4 ‚Äî GNOME, XFCE, KDE"
          body: |
            üöÄ **Solvionyx OS Aurora v4.3.4 ‚Äî Official Build**
            
            **Included Editions**
            - üñ•Ô∏è Aurora (GNOME)
            - üíª Aurora Lite (XFCE)
            - üé® Aurora Studio (KDE)
            
            **Changelog Highlights**
            - Debian 12.6 base
            - Updated desktop environments
            - Optimized boot time
            - Improved ISO build process
            
            **SHA256SUMS** included for verification.
          files: release/*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
